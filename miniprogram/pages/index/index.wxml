<view class="main">
  <!-- 顶部区域 -->
  <view class="header-container" wx:if="{{myUser.role === 3 || myUser.role === 2}}">
    <!-- 搜索和筛选 -->
    <view class="search-filter-container">
      <view class="search-box">
        <van-search
          value="{{ searchKeyword }}"
          placeholder="支持编号、现居地、学校查询"
          bind:change="onSearchChange"
          bind:search="onSearch"
          shape="round"
        />
      </view>
      <view class="filter-button" bindtap="showFilter">
        <text class="filter-text">筛选</text>
        <van-icon name="filter-o" size="14px" />
      </view>
    </view>
    
    <!-- 符合条件人数 -->
    <view class="info-bar">
      当前符合条件人数：{{ totalCount }}人
    </view>
  </view>
  
  <!-- 用户列表 -->
  <scroll-view class="scrollarea" scroll-y type="list">
    <view class="user-list">
      <!-- 用户卡片 -->
        <view 
          wx:for="{{ users }}" 
          wx:key="id" 
          class="user-card"
          bindtap="onUserClick"
          data-id="{{ item.id }}"
        >
          <view class="user-header">
            <view class="user-info-overlay">
              <view class="nickname">{{ item.nickName }}
                <view wx:if="{{item.gender !== 0}}" class="icon-box {{item.gender === 1 ? 'man' : item.gender === 2 ? 'woman' : ''}} ">
                  <image class="icon" src="{{GENDER_NUMBER_TO_LABEL[item.gender]}}" mode="aspectFill"/>
                </view>
              </view>
              <view class="basic-info">
                <text>{{ item.birthday }}年</text>
                <text>{{ item.height }}cm</text>
                <text wx:if="{{item.hometown !==''}}">{{ item.hometown }}</text>
              </view>
            </view>
          </view>
          <view class="user-detail">
            <view class="user-about">{{ item.aboutMe }}</view>
          </view>
        </view>
    </view>
  </scroll-view>
</view> 

<!-- 筛选弹窗 -->
<van-popup 
  show="{{ showFilterPopup }}" 
  position="right" 
  custom-style="width: 100%; height: 100%;" 
  bind:close="onFilterClose"
  overlay="{{false}}"
>
  <view class="filter-container">
    <!-- 顶部导航 -->
    <view class="filter-header">
      <view class="filter-back" bindtap="onFilterClose">
        <van-icon name="arrow-left" size="20px" />
        <text>返回</text>
      </view>
      <view class="filter-title">筛选</view>
      <view class="filter-placeholder"></view>
    </view>
    
    <!-- 筛选内容区域 -->
    <view class="filter-content">
      <!-- 左侧类别列表 -->
      <view class="filter-categories">
        <view class="filter-category {{currentCategory === 'gender' ? 'active' : ''}}" 
              bindtap="switchCategory" data-category="gender">
          <view class="category-indicator {{currentCategory === 'gender' ? 'active' : ''}}"></view>
          <text>性别</text>
        </view>
        <view class="filter-category {{currentCategory === 'age' ? 'active' : ''}}" 
              bindtap="switchCategory" data-category="age">
          <view class="category-indicator {{currentCategory === 'age' ? 'active' : ''}}"></view>
          <text>年龄</text>
        </view>
        <view class="filter-category {{currentCategory === 'height' ? 'active' : ''}}" 
              bindtap="switchCategory" data-category="height">
          <view class="category-indicator {{currentCategory === 'height' ? 'active' : ''}}"></view>
          <text>身高</text>
        </view>
        <view class="filter-category {{currentCategory === 'status' ? 'active' : ''}}" 
              bindtap="switchCategory" data-category="status">
          <view class="category-indicator {{currentCategory === 'status' ? 'active' : ''}}"></view>
          <text>目前状态</text>
        </view>
        <view class="filter-category {{currentCategory === 'education' ? 'active' : ''}}" 
              bindtap="switchCategory" data-category="education">
          <view class="category-indicator {{currentCategory === 'education' ? 'active' : ''}}"></view>
          <text>学历</text>
        </view>
        <!-- <view class="filter-category {{currentCategory === 'school' ? 'active' : ''}}" 
              bindtap="switchCategory" data-category="school">
          <view class="category-indicator {{currentCategory === 'school' ? 'active' : ''}}"></view>
          <text>学校</text>
        </view> -->
        <view class="filter-category {{currentCategory === 'location' ? 'active' : ''}}" 
              bindtap="switchCategory" data-category="location">
          <view class="category-indicator {{currentCategory === 'location' ? 'active' : ''}}"></view>
          <text>现居地</text>
        </view>
        <view class="filter-category {{currentCategory === 'hometown' ? 'active' : ''}}" 
              bindtap="switchCategory" data-category="hometown">
          <view class="category-indicator {{currentCategory === 'hometown' ? 'active' : ''}}"></view>
          <text>家乡</text>
        </view>
      </view>
      
      <!-- 右侧选项区域 -->
      <view class="filter-options">
        <!-- 性别筛选选项 -->
        <view class="gender-container" wx:if="{{currentCategory === 'gender'}}">
          <view class="gender-options">
            <view class="gender-option {{filters.gender === 0 ? 'active' : ''}}" bindtap="selectGender" data-gender="0">
              全部
            </view>
            <view class="gender-option {{filters.gender === 1 ? 'active' : ''}}" bindtap="selectGender" data-gender="1">
              男生
            </view>
            <view class="gender-option {{filters.gender === 2 ? 'active' : ''}}" bindtap="selectGender" data-gender="2">
              女生
            </view>
          </view>
        </view>
        
        <!-- 年龄范围选择 -->
        <view class="picker-container" wx:if="{{currentCategory === 'age'}}">
          <!-- 年龄范围选择器(一行两个) -->
          <view class="picker-row">
            <view class="picker-column">
              <van-picker 
                columns="{{ ageColumns }}" 
                default-index="{{ defaultMinAgeIndex }}"
                visible-item-count="5"
                bind:change="onMinAgeChange"
                value="{{ filters.minAge }}"
              />
            </view>
            <view class="picker-divider">-</view>
            <view class="picker-column">
              <van-picker 
                columns="{{ ageColumns }}" 
                default-index="{{ defaultMaxAgeIndex }}"
                visible-item-count="5"
                bind:change="onMaxAgeChange"
                value="{{ filters.maxAge }}"
              />
            </view>
          </view>
        </view>
        
        <!-- 身高范围选择 -->
        <view class="picker-container" wx:if="{{currentCategory === 'height'}}">
          <!-- 身高范围选择器(一行两个) -->
          <view class="picker-row">
            <view class="picker-column">
              <van-picker 
                columns="{{ heightColumns }}" 
                default-index="{{ defaultMinHeightIndex }}"
                visible-item-count="5"
                bind:change="onMinHeightChange"
                value="{{ filters.minHeight }}"
              />
            </view>
            <view class="picker-divider">-</view>
            <view class="picker-column">
              <van-picker 
                columns="{{ heightColumns }}" 
                default-index="{{ defaultMaxHeightIndex }}"
                visible-item-count="5"
                bind:change="onMaxHeightChange"
                value="{{ filters.maxHeight }}"
              />
            </view>
          </view>
        </view>
        
        <!-- 目前状态筛选选项 -->
        <view class="status-container" wx:if="{{currentCategory === 'status'}}">
          <view class="status-options">
            <view class="status-option {{filters.status === 0 ? 'active' : ''}}" bindtap="selectStatus" data-status="0">
              不限
            </view>
            <view class="status-option {{filters.status === 1 ? 'active' : ''}}" bindtap="selectStatus" data-status="1">
              在读
            </view>
            <view class="status-option {{filters.status === 2 ? 'active' : ''}}" bindtap="selectStatus" data-status="2">
              已工作
            </view>
          </view>
        </view>
        
        <!-- 学历筛选选项 -->
        <view class="education-container" wx:if="{{currentCategory === 'education'}}">
          <view class="education-options">
            <view class="education-option {{filters.education === 0 ? 'active' : ''}}" bindtap="selectEducation" data-education="0">
              不限
            </view>
            <view class="education-option {{filters.education === 1 ? 'active' : ''}}" bindtap="selectEducation" data-education="1">
              本科及以上
            </view>
            <view class="education-option {{filters.education === 2 ? 'active' : ''}}" bindtap="selectEducation" data-education="2">
              硕士及以上
            </view>
            <view class="education-option {{filters.education === 3 ? 'active' : ''}}" bindtap="selectEducation" data-education="3">
              博士及以上
            </view>
          </view>
        </view>
        
        <!-- 现居地筛选选项 -->
        <view class="location-container" wx:if="{{currentCategory === 'location'}}">
          <view class="location-title">输入现居地进行筛选</view>
          <view class="location-input-wrapper">
            <input 
              class="location-input" 
              type="text" 
              placeholder="请输入现居地，如：北京" 
              value="{{filters.location}}"
              bindinput="onLocationInput" 
              confirm-type="done"
            />
          </view>
          <view class="location-tip">支持模糊匹配，如输入"北京"会匹配所有现居地包含"北京"的用户</view>
        </view>
        
        <!-- 家乡筛选选项 -->
        <view class="hometown-container" wx:if="{{currentCategory === 'hometown'}}">
          <view class="hometown-title">输入家乡进行筛选</view>
          <view class="hometown-input-wrapper">
            <input 
              class="hometown-input" 
              type="text" 
              placeholder="请输入家乡，如：浙江" 
              value="{{filters.hometown}}"
              bindinput="onHometownInput" 
              confirm-type="done"
            />
          </view>
          <view class="hometown-tip">支持模糊匹配，如输入"浙江"会匹配所有家乡包含"浙江"的用户</view>
        </view>
      </view>
    </view>
    
    <!-- 底部按钮区域 -->
    <view class="filter-footer">
      <view class="clear-button" bindtap="resetFilter">清除</view>
      <view class="confirm-button" bindtap="applyFilter">确认</view>
    </view>
  </view>
</van-popup> 