<view class="page-main order-container">
  <!-- 订单状态： -->
  <view class="status-container">
    <text class="status-label">订单状态：</text>
    <view class="status-label status-color-{{payment.status}}">
      {{ORDER_STATUS_TO_LABEL[payment.status]}}
    </view>
  </view>
  <!-- 活动群 -->
  <view wx:if="{{payment.status !== 3}}" class="group-card">
    <image class="image" show-menu-by-longpress="{{true}}" src="{{ payment.tourSchedule.groupCodeImage }}" mode="scaleToFill" />
    <text class="image-tip">长按二维码加入活动出行群</text>
  </view>
  <!-- 活动信息卡片 -->
  <view class="base-card-new activity-card">
    <view class="base-card-title title-row">
      <text class="text-ellipsis">{{payment.activity.title}}</text>
    </view>
    <view class="date-row">
      <view class="duration-box">
        <text class="duration">{{payment.activity.duration}}</text>
        <text>天</text>
      </view>
      <view class="divider"></view>
      <view class="date-box">
        <view class="row">
          <text class="label">开始时间：</text>
          <text class="date">{{payment.tourSchedule.startDate}}</text>
        </view>
        <view class="row">
          <text class="label">结束时间：</text>
          <text class="date">{{payment.tourSchedule.endDate}}</text>
        </view>
        <view class="row">
          <text class="label">集合信息：</text>
          <text class="date">{{tourScheduleMember.meetingPoint}}</text>
        </view>
      </view>
    </view>
  </view>
  <!-- 退款 -->
  <view wx:if="{{payment.status >= 2 && payment.status <= 4 }}" class="base-card-new refund-card">
    <view class="base-card-title">退款</view>
    <van-cell title="退款原因" value="{{refund.reason}}" border="{{false}}"></van-cell>
    <van-cell title="客服回复" value="{{payment.status === 2 ? '处理中……' : refund.reviewComment}}" border="{{false}}"></van-cell>
  </view>
  <!-- 出行人信息 -->
  <view class="base-card-new people-card">
    <view class="base-card-title">出行人信息</view>
    <view class="people-card-content">
      <view class="avatar-box">
        <image class="avatar" src="{{user.avatar}}"></image>
        <!-- 1男 2女 0 不展示 -->
        <view wx:if="{{user.gender !== 0}}" class="icon-box {{user.gender === 1 ? 'man' : user.gender === 2 ? 'woman' : ''}} ">
          <image class="icon" src="{{GENDER_NUMBER_TO_LABEL[user.gender]}}" mode="aspectFill"/>
        </view>
      </view>
      <view class="base-info-box">
        <view class="nickname-row">
          <text class="nickname">{{user.nickname}}</text>
          <text class="university">{{user.university}}</text>
        </view>
        <view class="real-row">
          <text class="item">{{user.realName}}</text>
          <text class="item">{{user.idCard}}</text>
          <text>(保密)</text>
        </view>
      </view>
    </view>
  </view>
  <!-- 订单信息卡片 -->
  <view class="base-card-new order-card">
    <view class="base-card-title order-card-title">订单信息</view>
    <van-cell title="订单编号">
      <view slot="right-icon">
        <view class="order-number-cell-value">
          <view class="number">{{payment.showOutTradeNo}}</view>
          <view class="copy" bind:tap="onCopyOrderNo">|复制</view>
        </view>
      </view>
    </van-cell>
    <van-cell class="value" title="报名时间" value="{{payment.createdAt}}"></van-cell>
    <van-cell class="value" title="总金额" value="¥{{payment.finalAmount / 100}}"></van-cell>
    <van-cell class="{{ payment.couponId ? 'value' : 'placeholder' }}" title="优惠券" value="{{payment.couponId ? '已使用' : '未使用'}}"></van-cell>
    <van-cell class="{{ tourScheduleMember.leaderName ? 'value' : 'placeholder' }}" title="团报优惠(活动后返现)" value="{{tourScheduleMember.leaderName || '未填写'}}" center></van-cell>
    <van-cell title="集赞优惠(活动后返现)" center>
      <view slot="">
        <image class="like-img" wx:if="{{tourScheduleMember.discountImage}}" src="{{tourScheduleMember.discountImage}}" mode="aspectFill"></image>
        <text class="placeholder" wx:else class="img-alt">未上传</text>
      </view>
    </van-cell>
  </view>
  <!-- 备注卡片 -->
  <view class="base-card-new remark-card" wx:if="{{payment.status !== 3}}">
    <view class="base-card-title">备注</view>
    <van-field input-class="form-input" value="{{ tourScheduleMember.remark }}" placeholder="未填写" bind:change="onInputChange" data-id="remark" border="{{ false }}" type="textarea" autosize="{{ {minHeight: 40 } }}" disabled />
  </view>
  <!-- 底部分割线 -->
  <view class="page-bottom-space"></view>
  <!-- 吸底操作区 -->
  <van-submit-bar wx:if="{{payment.status < 2 || payment.status === 4}}" custom-class="submit-bar">
    <view class="submit-container" slot="">
      <view wx:if="{{payment.status === 0}}" class="button" bind:tap="cancelOrder">取消</view>
      <view wx:if="{{payment.status === 0}}" class="button red" bind:tap="payUnpaid">支付</view>
      <view wx:if="{{payment.status === 1}}" bindtap="applyRefund" class="button">申请退出</view>
      <view wx:if="{{payment.status === 4}}" class="button" bind:tap="applyRefund">再次申请退出</view>
    </view>
  </van-submit-bar>
  <!-- toast -->
  <van-toast id="van-toast" />
</view>